{"version":3,"file":"editor.directive.js","sources":["../../.tmp/editor/editor.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {ControlValueAccessor, NG_VALUE_ACCESSOR} from \"@angular/forms\";\nimport { Directive, ElementRef, EventEmitter, Input, NgZone, Optional, Output, Renderer, forwardRef } from '@angular/core';\n\ndeclare var $: JQueryStatic;\n\n\n@Directive({\n  selector: '[froalaEditor]',\n   providers: [{\n    provide: NG_VALUE_ACCESSOR,useExisting:\n      forwardRef(() => FroalaEditorDirective),\n    multi: true\n  }]\n})\nexport class FroalaEditorDirective implements ControlValueAccessor {\n\n  // editor options\n  private _opts: any = {\n    immediateAngularModelUpdate: false,\n    angularIgnoreAttrs: null\n  };\n\n  // jquery wrapped element\n  private _$element: any;\n\n  private SPECIAL_TAGS: string[] = ['img', 'button', 'input', 'a'];\n  private INNER_HTML_ATTR: string = 'innerHTML';\n  private _hasSpecialTag: boolean = false;\n\n  // editor element\n  private _editor: any;\n\n  // initial editor content\n  private _model: string;\n\n  private _listeningEvents: string[] = [];\n\n  private _editorInitialized: boolean = false;\n\n  private _oldModel: string = null;\n\n  constructor(el: ElementRef,  private zone: NgZone) {\n\n    let element: any = el.nativeElement;\n\n    // check if the element is a special tag\n    if (this.SPECIAL_TAGS.indexOf(element.tagName.toLowerCase()) != -1) {\n      this._hasSpecialTag = true;\n    }\n\n    // jquery wrap and store element\n    this._$element = (<any>$(element));\n\n    this.zone = zone;\n  }\n\n  // Begin ControlValueAccesor methods.\n  onChange = (_) => {};\n  onTouched = () => {};\n\n  // Form model content changed.\n  writeValue(content: any): void {\n    this.updateEditor(content);\n  }\n\n  registerOnChange(fn: (_: any) => void): void { this.onChange = fn; }\n  registerOnTouched(fn: () => void): void { this.onTouched = fn; }\n  // End ControlValueAccesor methods.\n\n  // froalaEditor directive as input: store the editor options\n  @Input() set froalaEditor(opts: any) {\n    this._opts = opts || this._opts;\n  }\n\n  // froalaModel directive as input: store initial editor content\n  @Input() set froalaModel(content: any) {\n    this.updateEditor(content);\n  }\n\n  // Update editor with model contents.\n  private updateEditor(content: any) {\n    if (JSON.stringify(this._oldModel) == JSON.stringify(content)) {\n      return;\n    }\n\n    if (!this._hasSpecialTag) {\n      this._oldModel = content;\n    }\n    else {\n      this._model = content;\n    }\n\n    if (this._editorInitialized) {\n      if (!this._hasSpecialTag) {\n        this._$element.froalaEditor('html.set', content);\n      }\n      else {\n        this.setContent();\n      }\n    }\n    else {\n      if (!this._hasSpecialTag) {\n        this._$element.html(content);\n      }\n      else {\n        this.setContent();\n      }\n    }\n  }\n\n  // froalaModel directive as output: update model if editor contentChanged\n  @Output() froalaModelChange: EventEmitter<any> = new EventEmitter<any>();\n\n  // froalaInit directive as output: send manual editor initialization\n  @Output() froalaInit: EventEmitter<Object> = new EventEmitter<Object>();\n\n  // update model if editor contentChanged\n  private updateModel() {\n    this.zone.run(() => {\n\n      let modelContent: any = null;\n\n      if (this._hasSpecialTag) {\n\n        let attributeNodes = this._$element[0].attributes;\n        let attrs = {};\n\n        for (let i = 0; i < attributeNodes.length; i++ ) {\n\n          let attrName = attributeNodes[i].name;\n          if (this._opts.angularIgnoreAttrs && this._opts.angularIgnoreAttrs.indexOf(attrName) != -1) {\n            continue;\n          }\n\n          attrs[attrName] = attributeNodes[i].value;\n        }\n\n        if (this._$element[0].innerHTML) {\n          attrs[this.INNER_HTML_ATTR] = this._$element[0].innerHTML;\n        }\n\n        modelContent = attrs;\n      } else {\n\n        let returnedHtml: any = this._$element.froalaEditor('html.get');\n        if (typeof returnedHtml === 'string') {\n          modelContent = returnedHtml;\n        }\n      }\n\n      this._oldModel = modelContent;\n\n      // Update froalaModel.\n      this.froalaModelChange.emit(modelContent);\n\n      // Update form model.\n      this.onChange(modelContent);\n\n    })\n  }\n\n  // register event on jquery element\n  private registerEvent(element, eventName, callback) {\n\n    if (!element || !eventName || !callback) {\n      return;\n    }\n\n    this._listeningEvents.push(eventName);\n    element.on(eventName, callback);\n  }\n\n  private initListeners() {\n\n    let self = this;\n\n    // bind contentChange and keyup event to froalaModel\n    this.registerEvent(this._$element, 'froalaEditor.contentChanged', function () {\n      setTimeout(function () {\n        self.updateModel();\n      }, 0);\n    });\n\n    if (this._opts.immediateAngularModelUpdate) {\n      this.registerEvent(this._editor, 'keyup', function () {\n        setTimeout(function (){\n          self.updateModel();\n        }, 0);\n      });\n    }\n  }\n\n  // register events from editor options\n  private registerFroalaEvents() {\n\n    if (!this._opts.events) {\n      return;\n    }\n\n    for (let eventName in this._opts.events) {\n\n      if (this._opts.events.hasOwnProperty(eventName)) {\n        this.registerEvent(this._$element, eventName, this._opts.events[eventName]);\n      }\n    }\n  }\n\n  private createEditor() {\n\n    if (this._editorInitialized) {\n      return;\n    }\n\n    this.setContent(true);\n\n    // Registering events before initializing the editor will bind the initialized event correctly.\n    this.registerFroalaEvents();\n\n    this.initListeners();\n\n    // init editor\n    this.zone.runOutsideAngular(() => {\n      this._$element.on('froalaEditor.initialized', () => {\n        this._editorInitialized = true;\n      })\n\n      this._editor = this._$element.froalaEditor(this._opts).data('froala.editor').$el;\n    })\n  }\n\n  private setHtml() {\n    this._$element.froalaEditor('html.set', this._model || '', true);\n\n    // This will reset the undo stack everytime the model changes externally. Can we fix this?\n    this._$element.froalaEditor('undo.reset');\n    this._$element.froalaEditor('undo.saveStep');\n  }\n\n  private setContent(firstTime = false) {\n    let self = this;\n\n    // Set initial content\n    if (this._model || this._model == '') {\n      this._oldModel = this._model;\n      if (this._hasSpecialTag) {\n\n        let tags: Object = this._model;\n\n        // add tags on element\n        if (tags) {\n\n          for (let attr in tags) {\n            if (tags.hasOwnProperty(attr) && attr != this.INNER_HTML_ATTR) {\n              this._$element.attr(attr, tags[attr]);\n            }\n          }\n\n          if (tags.hasOwnProperty(this.INNER_HTML_ATTR)) {\n            this._$element[0].innerHTML = tags[this.INNER_HTML_ATTR];\n          }\n        }\n      } else {\n        if (firstTime) {\n          this.registerEvent(this._$element, 'froalaEditor.initialized', function () {\n            self.setHtml();\n          });\n        } else {\n          self.setHtml();\n        }\n\n      }\n    }\n  }\n\n  private destroyEditor() {\n    if (this._editorInitialized) {\n      this._$element.off(this._listeningEvents.join(\" \"));\n      this._editor.off('keyup');\n      this._$element.froalaEditor('destroy');\n      this._listeningEvents.length = 0;\n      this._editorInitialized = false;\n    }\n  }\n\n  private getEditor() {\n    if (this._$element) {\n      return this._$element.froalaEditor.bind(this._$element);\n    }\n\n    return null;\n  }\n\n  // send manual editor initialization\n  private generateManualController() {\n    let self = this;\n    let controls = {\n      initialize: this.createEditor.bind(this),\n      destroy: this.destroyEditor.bind(this),\n      getEditor: this.getEditor.bind(this),\n    };\n    this.froalaInit.emit(controls);\n  }\n\n  // TODO not sure if ngOnInit is executed after @inputs\n  ngOnInit() {\n    // check if output froalaInit is present. Maybe observers is private and should not be used?? TODO how to better test that an output directive is present.\n    if (!this.froalaInit.observers.length) {\n      this.createEditor();\n    } else {\n      this.generateManualController();\n    }\n  }\n\n  ngOnDestroy() {\n    this.destroyEditor();\n  }\n}\n"]}